<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Rust quadtree with a clean Python API"><link href=https://elan456.github.io/fastquadtree/2.0_proposal/ rel=canonical><link rel=icon href=../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.7.1"><title>2.0 proposal - fastquadtree</title><link rel=stylesheet href=../assets/stylesheets/main.484c7ddc.min.css><link rel=stylesheet href=../assets/stylesheets/palette.ab4e12ef.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Inter:300,300i,400,400i,700,700i%7CJetBrains+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Inter";--md-code-font:"JetBrains Mono"}</style><link rel=stylesheet href=../assets/_mkdocstrings.css><link rel=stylesheet href=../styles/overrides.css><script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=deep-orange> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#fastquadtree-20-proposal class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=.. title=fastquadtree class="md-header__button md-logo" aria-label=fastquadtree data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> fastquadtree </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> 2.0 proposal </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=deep-orange aria-hidden=true type=radio name=__palette id=__palette_0> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/Elan456/fastquadtree title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> Elan456/fastquadtree </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=.. title=fastquadtree class="md-nav__button md-logo" aria-label=fastquadtree data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> fastquadtree </label> <div class=md-nav__source> <a href=https://github.com/Elan456/fastquadtree title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> Elan456/fastquadtree </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=.. class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class=md-nav__item> <a href=../quickstart/ class=md-nav__link> <span class=md-ellipsis> Quickstart </span> </a> </li> <li class=md-nav__item> <a href=../runnables/ class=md-nav__link> <span class=md-ellipsis> Runnables </span> </a> </li> <li class=md-nav__item> <a href=../benchmark/ class=md-nav__link> <span class=md-ellipsis> Benchmark </span> </a> </li> <li class=md-nav__item> <a href=../future_features/ class=md-nav__link> <span class=md-ellipsis> Future Features </span> </a> </li> <li class=md-nav__item> <a href=../rust_usage/ class=md-nav__link> <span class=md-ellipsis> Rust Usage </span> </a> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7 id=__nav_7_label tabindex> <span class=md-ellipsis> API </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_7_label aria-expanded=false> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> API </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../api/quadtree/ class=md-nav__link> <span class=md-ellipsis> QuadTree </span> </a> </li> <li class=md-nav__item> <a href=../api/rect_quadtree/ class=md-nav__link> <span class=md-ellipsis> RectQuadTree </span> </a> </li> <li class=md-nav__item> <a href=../api/quadtree_objects/ class=md-nav__link> <span class=md-ellipsis> QuadTreeObjects </span> </a> </li> <li class=md-nav__item> <a href=../api/rect_quadtree_objects/ class=md-nav__link> <span class=md-ellipsis> RectQuadTreeObjects </span> </a> </li> <li class=md-nav__item> <a href=../api/pyqtree/ class=md-nav__link> <span class=md-ellipsis> pyqtree </span> </a> </li> <li class=md-nav__item> <a href=../api/item/ class=md-nav__link> <span class=md-ellipsis> Item </span> </a> </li> <li class=md-nav__item> <a href=../api/point_item/ class=md-nav__link> <span class=md-ellipsis> PointItem </span> </a> </li> <li class=md-nav__item> <a href=../api/rect_item/ class=md-nav__link> <span class=md-ellipsis> RectItem </span> </a> </li> <li class=md-nav__item> <a href=../api/insert_result/ class=md-nav__link> <span class=md-ellipsis> InsertResult </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../2.0_migration_guide/ class=md-nav__link> <span class=md-ellipsis> v1.x to v2.0 Migration Guide </span> </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#fastquadtree-20-proposal class=md-nav__link> <span class=md-ellipsis> fastquadtree 2.0 Proposal </span> </a> </li> <li class=md-nav__item> <a href=#target-audiences class=md-nav__link> <span class=md-ellipsis> Target Audiences </span> </a> </li> <li class=md-nav__item> <a href=#overview-of-v20-direction class=md-nav__link> <span class=md-ellipsis> Overview of v2.0 Direction </span> </a> </li> <li class=md-nav__item> <a href=#breaking-changes class=md-nav__link> <span class=md-ellipsis> Breaking Changes </span> </a> <nav class=md-nav aria-label="Breaking Changes"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-split-object-association-into-separate-classes class=md-nav__link> <span class=md-ellipsis> 1) Split Object Association into Separate Classes </span> </a> <nav class=md-nav aria-label="1) Split Object Association into Separate Classes"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#current-api class=md-nav__link> <span class=md-ellipsis> Current API </span> </a> </li> <li class=md-nav__item> <a href=#new-api class=md-nav__link> <span class=md-ellipsis> New API </span> </a> </li> <li class=md-nav__item> <a href=#naming-rationale class=md-nav__link> <span class=md-ellipsis> Naming rationale </span> </a> </li> <li class=md-nav__item> <a href=#why-this-change class=md-nav__link> <span class=md-ellipsis> Why this change </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2-predictable-query-return-types-no-as_items class=md-nav__link> <span class=md-ellipsis> 2) Predictable Query Return Types (No as_items) </span> </a> <nav class=md-nav aria-label="2) Predictable Query Return Types (No as_items)"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#quadtree-no-objects class=md-nav__link> <span class=md-ellipsis> QuadTree (no objects) </span> </a> </li> <li class=md-nav__item> <a href=#quadtreeobjects-objects class=md-nav__link> <span class=md-ellipsis> QuadTreeObjects (objects) </span> </a> </li> <li class=md-nav__item> <a href=#impact class=md-nav__link> <span class=md-ellipsis> Impact </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#3-explicit-numpy-methods-_np-only class=md-nav__link> <span class=md-ellipsis> 3) Explicit NumPy Methods (_np) Only </span> </a> <nav class=md-nav aria-label="3) Explicit NumPy Methods (_np) Only"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#current-behavior-v1 class=md-nav__link> <span class=md-ellipsis> Current behavior (v1) </span> </a> </li> <li class=md-nav__item> <a href=#new-behavior-v2 class=md-nav__link> <span class=md-ellipsis> New behavior (v2) </span> </a> </li> <li class=md-nav__item> <a href=#rules class=md-nav__link> <span class=md-ellipsis> Rules </span> </a> </li> <li class=md-nav__item> <a href=#numpy-output-guarantees class=md-nav__link> <span class=md-ellipsis> NumPy output guarantees </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#4-improved-insertion-api class=md-nav__link> <span class=md-ellipsis> 4) Improved Insertion API </span> </a> <nav class=md-nav aria-label="4) Improved Insertion API"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#single-insertion-with-optional-custom-id-non-objects-classes class=md-nav__link> <span class=md-ellipsis> Single insertion with optional custom ID (non-Objects classes) </span> </a> </li> <li class=md-nav__item> <a href=#bulk-insertion-with-insertresult class=md-nav__link> <span class=md-ellipsis> Bulk insertion with InsertResult </span> </a> </li> <li class=md-nav__item> <a href=#objects-variants-support-payloads class=md-nav__link> <span class=md-ellipsis> Objects variants support payloads </span> </a> </li> <li class=md-nav__item> <a href=#insertresult class=md-nav__link> <span class=md-ellipsis> InsertResult </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#5-deletion-semantics-and-duplicates class=md-nav__link> <span class=md-ellipsis> 5) Deletion Semantics (and duplicates) </span> </a> <nav class=md-nav aria-label="5) Deletion Semantics (and duplicates)"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#non-objects-classes-require-coordinates class=md-nav__link> <span class=md-ellipsis> Non-Objects classes require coordinates </span> </a> </li> <li class=md-nav__item> <a href=#objects-classes-can-delete-by-id-alone class=md-nav__link> <span class=md-ellipsis> Objects classes can delete by id alone </span> </a> </li> <li class=md-nav__item> <a href=#location-based-deletion-for-objects-variants class=md-nav__link> <span class=md-ellipsis> Location-based deletion for Objects variants </span> </a> </li> <li class=md-nav__item> <a href=#object-deletion-semantics-identity-not-equality class=md-nav__link> <span class=md-ellipsis> Object deletion semantics (identity, not equality) </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#6-remove-count_items-keep-len-only class=md-nav__link> <span class=md-ellipsis> 6) Remove count_items(), keep len() only </span> </a> </li> <li class=md-nav__item> <a href=#7-serialization-bytes-only-dtype-encoded-objects-opt-in-and-guarded class=md-nav__link> <span class=md-ellipsis> 7) Serialization: bytes-only, dtype encoded, objects opt-in and guarded </span> </a> <nav class=md-nav aria-label="7) Serialization: bytes-only, dtype encoded, objects opt-in and guarded"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#new-api_1 class=md-nav__link> <span class=md-ellipsis> New API </span> </a> </li> <li class=md-nav__item> <a href=#objects-trees class=md-nav__link> <span class=md-ellipsis> Objects trees </span> </a> </li> <li class=md-nav__item> <a href=#safety-notes class=md-nav__link> <span class=md-ellipsis> Safety notes </span> </a> </li> <li class=md-nav__item> <a href=#impact_1 class=md-nav__link> <span class=md-ellipsis> Impact </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#new-features-non-breaking-additions class=md-nav__link> <span class=md-ellipsis> New Features (Non-breaking additions) </span> </a> <nav class=md-nav aria-label="New Features (Non-breaking additions)"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#__contains__ class=md-nav__link> <span class=md-ellipsis> __contains__ </span> </a> </li> <li class=md-nav__item> <a href=#iteration class=md-nav__link> <span class=md-ellipsis> Iteration </span> </a> </li> <li class=md-nav__item> <a href=#moving-items-efficient-where-possible class=md-nav__link> <span class=md-ellipsis> Moving items: efficient where possible </span> </a> <nav class=md-nav aria-label="Moving items: efficient where possible"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#points class=md-nav__link> <span class=md-ellipsis> Points </span> </a> </li> <li class=md-nav__item> <a href=#rectangles class=md-nav__link> <span class=md-ellipsis> Rectangles </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#update_by_object-helper-objects-classes-only class=md-nav__link> <span class=md-ellipsis> update_by_object helper (Objects classes only) </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#migration-guide class=md-nav__link> <span class=md-ellipsis> Migration Guide </span> </a> <nav class=md-nav aria-label="Migration Guide"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#step-1-choose-your-class class=md-nav__link> <span class=md-ellipsis> Step 1: Choose your class </span> </a> </li> <li class=md-nav__item> <a href=#step-2-imports class=md-nav__link> <span class=md-ellipsis> Step 2: Imports </span> </a> </li> <li class=md-nav__item> <a href=#step-3-queries class=md-nav__link> <span class=md-ellipsis> Step 3: Queries </span> </a> </li> <li class=md-nav__item> <a href=#step-4-numpy-calls class=md-nav__link> <span class=md-ellipsis> Step 4: NumPy calls </span> </a> </li> <li class=md-nav__item> <a href=#step-5-insert-results class=md-nav__link> <span class=md-ellipsis> Step 5: Insert results </span> </a> </li> <li class=md-nav__item> <a href=#step-6-deletion class=md-nav__link> <span class=md-ellipsis> Step 6: Deletion </span> </a> </li> <li class=md-nav__item> <a href=#step-7-updatemove class=md-nav__link> <span class=md-ellipsis> Step 7: Update/move </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#appendix-v20-api-reference-proposed class=md-nav__link> <span class=md-ellipsis> Appendix: v2.0 API Reference (Proposed) </span> </a> <nav class=md-nav aria-label="Appendix: v2.0 API Reference (Proposed)"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#quadtree-points-no-objects class=md-nav__link> <span class=md-ellipsis> QuadTree (points, no objects) </span> </a> </li> <li class=md-nav__item> <a href=#quadtreeobjects-points-with-python-objects class=md-nav__link> <span class=md-ellipsis> QuadTreeObjects (points with Python objects) </span> </a> </li> <li class=md-nav__item> <a href=#rectquadtree-rectangles-no-objects class=md-nav__link> <span class=md-ellipsis> RectQuadTree (rectangles, no objects) </span> </a> </li> <li class=md-nav__item> <a href=#rectquadtreeobjects-rectangles-with-python-objects class=md-nav__link> <span class=md-ellipsis> RectQuadTreeObjects (rectangles with Python objects) </span> </a> </li> <li class=md-nav__item> <a href=#data-classes class=md-nav__link> <span class=md-ellipsis> Data Classes </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#implementation-details class=md-nav__link> <span class=md-ellipsis> Implementation Details </span> </a> <nav class=md-nav aria-label="Implementation Details"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#objstore-efficient-object-tracking class=md-nav__link> <span class=md-ellipsis> ObjStore: Efficient Object Tracking </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h2 id=fastquadtree-20-proposal>fastquadtree 2.0 Proposal<a class=headerlink href=#fastquadtree-20-proposal title="Permanent link">&para;</a></h2> <p>This document describes the breaking changes planned for fastquadtree v2.0. The goals are:</p> <ul> <li>A simpler, more predictable Python API</li> <li>Zero overhead for users who do not need object association</li> <li>First-class NumPy workflows without runtime type branching</li> <li>Safer, more explicit semantics around precision limits and serialization</li> </ul> <hr> <h2 id=target-audiences>Target Audiences<a class=headerlink href=#target-audiences title="Permanent link">&para;</a></h2> <ul> <li><strong>New Python developers</strong>: intuitive classes, predictable return types</li> <li><strong>Performance-focused users</strong>: fastest possible hot paths, minimal memory overhead</li> <li><strong>Scientific users</strong>: consistent NumPy I/O shapes and dtypes, clean data handling</li> </ul> <hr> <h2 id=overview-of-v20-direction>Overview of v2.0 Direction<a class=headerlink href=#overview-of-v20-direction title="Permanent link">&para;</a></h2> <p>v2.0 will:</p> <ul> <li>Split object association into dedicated "Objects" classes</li> <li>Remove mode-dependent return types (<code>track_objects</code>, <code>as_items</code>)</li> <li>Provide explicit NumPy APIs via <code>_np</code> methods (no runtime type detection)</li> <li>Simplify serialization and make object serialization explicit and opt-in</li> </ul> <hr> <h1 id=breaking-changes>Breaking Changes<a class=headerlink href=#breaking-changes title="Permanent link">&para;</a></h1> <h2 id=1-split-object-association-into-separate-classes>1) Split Object Association into Separate Classes<a class=headerlink href=#1-split-object-association-into-separate-classes title="Permanent link">&para;</a></h2> <h3 id=current-api>Current API<a class=headerlink href=#current-api title="Permanent link">&para;</a></h3> <div class="language-python highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=n>qt</span> <span class=o>=</span> <span class=n>QuadTree</span><span class=p>(</span><span class=n>bounds</span><span class=p>,</span> <span class=n>capacity</span><span class=p>,</span> <span class=n>track_objects</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>   <span class=c1># or False</span>
</span><span id=__span-0-2><a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a><span class=n>rqt</span> <span class=o>=</span> <span class=n>RectQuadTree</span><span class=p>(</span><span class=n>bounds</span><span class=p>,</span> <span class=n>capacity</span><span class=p>,</span> <span class=n>track_objects</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>  <span class=c1># or False</span>
</span></code></pre></div> <h3 id=new-api>New API<a class=headerlink href=#new-api title="Permanent link">&para;</a></h3> <div class="language-python highlight"><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=c1># High performance spatial index (no object association)</span>
</span><span id=__span-1-2><a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a><span class=n>qt</span> <span class=o>=</span> <span class=n>QuadTree</span><span class=p>(</span><span class=n>bounds</span><span class=p>,</span> <span class=n>capacity</span><span class=p>)</span>
</span><span id=__span-1-3><a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a><span class=n>rqt</span> <span class=o>=</span> <span class=n>RectQuadTree</span><span class=p>(</span><span class=n>bounds</span><span class=p>,</span> <span class=n>capacity</span><span class=p>)</span>
</span><span id=__span-1-4><a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a>
</span><span id=__span-1-5><a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a><span class=c1># Spatial index with Python object association</span>
</span><span id=__span-1-6><a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a><span class=n>qt_obj</span> <span class=o>=</span> <span class=n>QuadTreeObjects</span><span class=p>(</span><span class=n>bounds</span><span class=p>,</span> <span class=n>capacity</span><span class=p>)</span>
</span><span id=__span-1-7><a id=__codelineno-1-7 name=__codelineno-1-7 href=#__codelineno-1-7></a><span class=n>rqt_obj</span> <span class=o>=</span> <span class=n>RectQuadTreeObjects</span><span class=p>(</span><span class=n>bounds</span><span class=p>,</span> <span class=n>capacity</span><span class=p>)</span>
</span></code></pre></div> <h3 id=naming-rationale>Naming rationale<a class=headerlink href=#naming-rationale title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th>Class</th> <th>Purpose</th> <th>Mental model</th> </tr> </thead> <tbody> <tr> <td><code>QuadTree</code></td> <td>Fast index for points</td> <td>"store points with IDs"</td> </tr> <tr> <td><code>QuadTreeObjects</code></td> <td>Points with associated Python objects</td> <td>"points plus attached payloads"</td> </tr> <tr> <td><code>RectQuadTree</code></td> <td>Fast index for rectangles</td> <td>"store boxes with IDs"</td> </tr> <tr> <td><code>RectQuadTreeObjects</code></td> <td>Rectangles with associated Python objects</td> <td>"boxes plus attached payloads"</td> </tr> </tbody> </table> <h3 id=why-this-change>Why this change<a class=headerlink href=#why-this-change title="Permanent link">&para;</a></h3> <ul> <li>Eliminates runtime branching and confusing toggles (<code>track_objects</code>, <code>as_items</code>)</li> <li>Keeps the fastest class as the default (<code>QuadTree</code>, <code>RectQuadTree</code>)</li> <li>Clear separation of capabilities and better typing</li> </ul> <hr> <h2 id=2-predictable-query-return-types-no-as_items>2) Predictable Query Return Types (No <code>as_items</code>)<a class=headerlink href=#2-predictable-query-return-types-no-as_items title="Permanent link">&para;</a></h2> <h3 id=quadtree-no-objects><code>QuadTree</code> (no objects)<a class=headerlink href=#quadtree-no-objects title="Permanent link">&para;</a></h3> <div class="language-python highlight"><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=n>results</span> <span class=o>=</span> <span class=n>qt</span><span class=o>.</span><span class=n>query</span><span class=p>(</span><span class=n>rect</span><span class=p>)</span>  <span class=c1># list[tuple[int, float, float]]</span>
</span><span id=__span-2-2><a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a>
</span><span id=__span-2-3><a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a><span class=k>for</span> <span class=n>id_</span><span class=p>,</span> <span class=n>x</span><span class=p>,</span> <span class=n>y</span> <span class=ow>in</span> <span class=n>results</span><span class=p>:</span>
</span><span id=__span-2-4><a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a>    <span class=o>...</span>
</span></code></pre></div> <h3 id=quadtreeobjects-objects><code>QuadTreeObjects</code> (objects)<a class=headerlink href=#quadtreeobjects-objects title="Permanent link">&para;</a></h3> <div class="language-python highlight"><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=n>results</span> <span class=o>=</span> <span class=n>qt_obj</span><span class=o>.</span><span class=n>query</span><span class=p>(</span><span class=n>rect</span><span class=p>)</span>  <span class=c1># list[PointItem]</span>
</span><span id=__span-3-2><a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a>
</span><span id=__span-3-3><a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a><span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=n>results</span><span class=p>:</span>
</span><span id=__span-3-4><a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a>    <span class=nb>print</span><span class=p>(</span><span class=n>item</span><span class=o>.</span><span class=n>id_</span><span class=p>,</span> <span class=n>item</span><span class=o>.</span><span class=n>x</span><span class=p>,</span> <span class=n>item</span><span class=o>.</span><span class=n>y</span><span class=p>,</span> <span class=n>item</span><span class=o>.</span><span class=n>obj</span><span class=p>)</span>
</span><span id=__span-3-5><a id=__codelineno-3-5 name=__codelineno-3-5 href=#__codelineno-3-5></a>
</span><span id=__span-3-6><a id=__codelineno-3-6 name=__codelineno-3-6 href=#__codelineno-3-6></a><span class=n>ids</span> <span class=o>=</span> <span class=n>qt_obj</span><span class=o>.</span><span class=n>query_ids</span><span class=p>(</span><span class=n>rect</span><span class=p>)</span>  <span class=c1># list[int] fast path</span>
</span></code></pre></div> <h3 id=impact>Impact<a class=headerlink href=#impact title="Permanent link">&para;</a></h3> <ul> <li>Remove <code>as_items</code> everywhere</li> <li>If you previously used <code>as_items=True</code>, migrate to <code>QuadTreeObjects</code></li> <li>If you previously used the default tuple output, stay on <code>QuadTree</code></li> </ul> <hr> <h2 id=3-explicit-numpy-methods-_np-only>3) Explicit NumPy Methods (<code>_np</code>) Only<a class=headerlink href=#3-explicit-numpy-methods-_np-only title="Permanent link">&para;</a></h2> <h3 id=current-behavior-v1>Current behavior (v1)<a class=headerlink href=#current-behavior-v1 title="Permanent link">&para;</a></h3> <ul> <li><code>insert_many</code> accepts list or ndarray and branches at runtime</li> </ul> <h3 id=new-behavior-v2>New behavior (v2)<a class=headerlink href=#new-behavior-v2 title="Permanent link">&para;</a></h3> <div class="language-python highlight"><pre><span></span><code><span id=__span-4-1><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=n>qt</span><span class=o>.</span><span class=n>insert_many</span><span class=p>([(</span><span class=n>x1</span><span class=p>,</span> <span class=n>y1</span><span class=p>),</span> <span class=p>(</span><span class=n>x2</span><span class=p>,</span> <span class=n>y2</span><span class=p>)])</span>  <span class=c1># Python sequences only</span>
</span><span id=__span-4-2><a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a><span class=n>qt</span><span class=o>.</span><span class=n>insert_many_np</span><span class=p>(</span><span class=n>xy_array</span><span class=p>)</span>           <span class=c1># NumPy only</span>
</span><span id=__span-4-3><a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a>
</span><span id=__span-4-4><a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a><span class=n>qt</span><span class=o>.</span><span class=n>query</span><span class=p>(</span><span class=n>rect</span><span class=p>)</span>                        <span class=c1># Python list output</span>
</span><span id=__span-4-5><a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a><span class=n>ids</span><span class=p>,</span> <span class=n>coords</span> <span class=o>=</span> <span class=n>qt</span><span class=o>.</span><span class=n>query_np</span><span class=p>(</span><span class=n>rect</span><span class=p>)</span>        <span class=c1># NumPy output</span>
</span><span id=__span-4-6><a id=__codelineno-4-6 name=__codelineno-4-6 href=#__codelineno-4-6></a>
</span><span id=__span-4-7><a id=__codelineno-4-7 name=__codelineno-4-7 href=#__codelineno-4-7></a><span class=n>ids</span><span class=p>,</span> <span class=n>coords</span> <span class=o>=</span> <span class=n>qt</span><span class=o>.</span><span class=n>nearest_neighbors_np</span><span class=p>(</span><span class=n>point</span><span class=p>,</span> <span class=n>k</span><span class=p>)</span>
</span></code></pre></div> <h3 id=rules>Rules<a class=headerlink href=#rules title="Permanent link">&para;</a></h3> <ul> <li>Passing a NumPy array into a non-<code>_np</code> method raises <code>TypeError</code></li> <li><code>_np</code> methods require NumPy installed (raise <code>ImportError</code> if missing)</li> </ul> <h3 id=numpy-output-guarantees>NumPy output guarantees<a class=headerlink href=#numpy-output-guarantees title="Permanent link">&para;</a></h3> <ul> <li><code>ids</code> is <code>np.uint64</code> with shape <code>(N,)</code></li> <li><code>coords</code> is <code>np.float32</code>, <code>np.float64</code>, <code>np.int32</code>, or <code>np.int64</code> matching <code>dtype</code>, shape <code>(N, 2)</code> for points and <code>(N, 4)</code> for rects</li> </ul> <hr> <h2 id=4-improved-insertion-api>4) Improved Insertion API<a class=headerlink href=#4-improved-insertion-api title="Permanent link">&para;</a></h2> <h3 id=single-insertion-with-optional-custom-id-non-objects-classes>Single insertion with optional custom ID (non-Objects classes)<a class=headerlink href=#single-insertion-with-optional-custom-id-non-objects-classes title="Permanent link">&para;</a></h3> <div class="language-python highlight"><pre><span></span><code><span id=__span-5-1><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=n>id_</span> <span class=o>=</span> <span class=n>qt</span><span class=o>.</span><span class=n>insert</span><span class=p>((</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>))</span>           <span class=c1># auto-assigned ID</span>
</span><span id=__span-5-2><a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a><span class=n>id_</span> <span class=o>=</span> <span class=n>qt</span><span class=o>.</span><span class=n>insert</span><span class=p>((</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>),</span> <span class=n>id_</span><span class=o>=</span><span class=mi>42</span><span class=p>)</span>   <span class=c1># custom ID</span>
</span></code></pre></div> <p>This allows users to correlate quadtree entries with external data structures (e.g., indices into a list or dataset) without the overhead of object association.</p> <p><strong>Warning:</strong> Mixing auto-assigned and custom IDs is dangerous. The quadtree does not track which IDs have been used. If you provide a custom ID that collides with an auto-assigned ID (or vice versa), both entries will exist in the tree with the same ID, leading to undefined behavior on deletion and update. Users who provide custom IDs are responsible for ensuring uniqueness.</p> <h3 id=bulk-insertion-with-insertresult>Bulk insertion with <code>InsertResult</code><a class=headerlink href=#bulk-insertion-with-insertresult title="Permanent link">&para;</a></h3> <div class="language-python highlight"><pre><span></span><code><span id=__span-6-1><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=n>result</span> <span class=o>=</span> <span class=n>qt</span><span class=o>.</span><span class=n>insert_many</span><span class=p>([(</span><span class=n>x1</span><span class=p>,</span> <span class=n>y1</span><span class=p>),</span> <span class=p>(</span><span class=n>x2</span><span class=p>,</span> <span class=n>y2</span><span class=p>)])</span>
</span><span id=__span-6-2><a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a>
</span><span id=__span-6-3><a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a><span class=n>result</span><span class=o>.</span><span class=n>count</span>
</span><span id=__span-6-4><a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a><span class=n>result</span><span class=o>.</span><span class=n>start_id</span>
</span><span id=__span-6-5><a id=__codelineno-6-5 name=__codelineno-6-5 href=#__codelineno-6-5></a><span class=n>result</span><span class=o>.</span><span class=n>end_id</span>
</span></code></pre></div> <p>IDs are contiguous in the inserted range: <code>[start_id, ..., end_id]</code>.</p> <p>Bulk insertion does not support custom IDs. Use single <code>insert()</code> calls if you need custom IDs.</p> <p><strong>Note:</strong> For performance, <code>insert_many()</code> and <code>insert_many_np()</code> always append new items and do not reuse IDs from the free-list created by deletions. Use single <code>insert()</code> calls to fill holes in the ID space.</p> <h3 id=objects-variants-support-payloads>Objects variants support payloads<a class=headerlink href=#objects-variants-support-payloads title="Permanent link">&para;</a></h3> <div class="language-python highlight"><pre><span></span><code><span id=__span-7-1><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=n>qt_obj</span><span class=o>.</span><span class=n>insert</span><span class=p>((</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>),</span> <span class=n>obj</span><span class=o>=</span><span class=n>my_data</span><span class=p>)</span>
</span><span id=__span-7-2><a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a><span class=n>qt_obj</span><span class=o>.</span><span class=n>insert_many</span><span class=p>(</span><span class=n>coords</span><span class=p>,</span> <span class=n>objs</span><span class=o>=</span><span class=p>[</span><span class=n>obj1</span><span class=p>,</span> <span class=n>obj2</span><span class=p>,</span> <span class=o>...</span><span class=p>])</span>
</span></code></pre></div> <p><code>QuadTreeObjects</code> does <strong>not</strong> support custom IDs because it uses dense ID allocation internally for efficient object lookup.</p> <h3 id=insertresult>InsertResult<a class=headerlink href=#insertresult title="Permanent link">&para;</a></h3> <div class="language-python highlight"><pre><span></span><code><span id=__span-8-1><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a><span class=nd>@dataclass</span>
</span><span id=__span-8-2><a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a><span class=k>class</span><span class=w> </span><span class=nc>InsertResult</span><span class=p>:</span>
</span><span id=__span-8-3><a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a>    <span class=n>count</span><span class=p>:</span> <span class=nb>int</span>
</span><span id=__span-8-4><a id=__codelineno-8-4 name=__codelineno-8-4 href=#__codelineno-8-4></a>    <span class=n>start_id</span><span class=p>:</span> <span class=nb>int</span>
</span><span id=__span-8-5><a id=__codelineno-8-5 name=__codelineno-8-5 href=#__codelineno-8-5></a>    <span class=n>end_id</span><span class=p>:</span> <span class=nb>int</span>
</span><span id=__span-8-6><a id=__codelineno-8-6 name=__codelineno-8-6 href=#__codelineno-8-6></a>
</span><span id=__span-8-7><a id=__codelineno-8-7 name=__codelineno-8-7 href=#__codelineno-8-7></a>    <span class=nd>@property</span>
</span><span id=__span-8-8><a id=__codelineno-8-8 name=__codelineno-8-8 href=#__codelineno-8-8></a>    <span class=k>def</span><span class=w> </span><span class=nf>ids</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-8-9><a id=__codelineno-8-9 name=__codelineno-8-9 href=#__codelineno-8-9></a>        <span class=k>return</span> <span class=nb>range</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>start_id</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>end_id</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span>
</span></code></pre></div> <hr> <h2 id=5-deletion-semantics-and-duplicates>5) Deletion Semantics (and duplicates)<a class=headerlink href=#5-deletion-semantics-and-duplicates title="Permanent link">&para;</a></h2> <h3 id=non-objects-classes-require-coordinates>Non-Objects classes require coordinates<a class=headerlink href=#non-objects-classes-require-coordinates title="Permanent link">&para;</a></h3> <div class="language-python highlight"><pre><span></span><code><span id=__span-9-1><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a><span class=n>qt</span><span class=o>.</span><span class=n>delete</span><span class=p>(</span><span class=n>id_</span><span class=p>,</span> <span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>)</span>
</span><span id=__span-9-2><a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a><span class=n>rqt</span><span class=o>.</span><span class=n>delete</span><span class=p>(</span><span class=n>id_</span><span class=p>,</span> <span class=n>min_x</span><span class=p>,</span> <span class=n>min_y</span><span class=p>,</span> <span class=n>max_x</span><span class=p>,</span> <span class=n>max_y</span><span class=p>)</span>
</span></code></pre></div> <h3 id=objects-classes-can-delete-by-id-alone>Objects classes can delete by id alone<a class=headerlink href=#objects-classes-can-delete-by-id-alone title="Permanent link">&para;</a></h3> <div class="language-python highlight"><pre><span></span><code><span id=__span-10-1><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a><span class=n>qt_obj</span><span class=o>.</span><span class=n>delete</span><span class=p>(</span><span class=n>id_</span><span class=p>)</span>
</span><span id=__span-10-2><a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a><span class=n>rqt_obj</span><span class=o>.</span><span class=n>delete</span><span class=p>(</span><span class=n>id_</span><span class=p>)</span>
</span></code></pre></div> <h3 id=location-based-deletion-for-objects-variants>Location-based deletion for Objects variants<a class=headerlink href=#location-based-deletion-for-objects-variants title="Permanent link">&para;</a></h3> <div class="language-python highlight"><pre><span></span><code><span id=__span-11-1><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a><span class=n>qt_obj</span><span class=o>.</span><span class=n>delete_at</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>)</span>
</span></code></pre></div> <p><strong>Duplicate points:</strong> If multiple items exist at <code>(x, y)</code>, <code>delete_at(x, y)</code> deletes the lowest <code>id_</code> among matches. This is deterministic and documented.</p> <h3 id=object-deletion-semantics-identity-not-equality>Object deletion semantics (identity, not equality)<a class=headerlink href=#object-deletion-semantics-identity-not-equality title="Permanent link">&para;</a></h3> <div class="language-python highlight"><pre><span></span><code><span id=__span-12-1><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a><span class=n>qt_obj</span><span class=o>.</span><span class=n>delete_by_object</span><span class=p>(</span><span class=n>obj</span><span class=p>)</span>  <span class=c1># uses identity (is), deletes ALL matches</span>
</span><span id=__span-12-2><a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a><span class=n>qt_obj</span><span class=o>.</span><span class=n>delete_one_by_object</span><span class=p>(</span><span class=n>obj</span><span class=p>)</span>  <span class=c1># deletes one match (lowest id_)</span>
</span></code></pre></div> <p>Identity-based deletion avoids surprising behavior with <code>__eq__</code>, mutability, or duplicates.</p> <p><strong>Duplicate object handling:</strong> The same Python object can be inserted multiple times at different locations. The implementation tracks all IDs associated with each object: - <code>delete_by_object(obj)</code> deletes <strong>all items</strong> with that object (by identity) and returns the count - <code>delete_one_by_object(obj)</code> deletes <strong>exactly one item</strong> (deterministically: the one with the lowest ID) - <code>by_obj()</code> internal lookups return the item with the <strong>lowest ID</strong> (deterministic) - <code>attach()</code> correctly updates the reverse mapping when replacing objects</p> <hr> <h2 id=6-remove-count_items-keep-len-only>6) Remove <code>count_items()</code>, keep <code>len()</code> only<a class=headerlink href=#6-remove-count_items-keep-len-only title="Permanent link">&para;</a></h2> <div class="language-python highlight"><pre><span></span><code><span id=__span-13-1><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a><span class=n>n</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>qt</span><span class=p>)</span>
</span></code></pre></div> <hr> <h2 id=7-serialization-bytes-only-dtype-encoded-objects-opt-in-and-guarded>7) Serialization: bytes-only, dtype encoded, objects opt-in and guarded<a class=headerlink href=#7-serialization-bytes-only-dtype-encoded-objects-opt-in-and-guarded title="Permanent link">&para;</a></h2> <h3 id=new-api_1>New API<a class=headerlink href=#new-api_1 title="Permanent link">&para;</a></h3> <div class="language-python highlight"><pre><span></span><code><span id=__span-14-1><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a><span class=n>data</span> <span class=o>=</span> <span class=n>qt</span><span class=o>.</span><span class=n>to_bytes</span><span class=p>()</span>
</span><span id=__span-14-2><a id=__codelineno-14-2 name=__codelineno-14-2 href=#__codelineno-14-2></a><span class=n>qt2</span> <span class=o>=</span> <span class=n>QuadTree</span><span class=o>.</span><span class=n>from_bytes</span><span class=p>(</span><span class=n>data</span><span class=p>)</span>
</span></code></pre></div> <h3 id=objects-trees>Objects trees<a class=headerlink href=#objects-trees title="Permanent link">&para;</a></h3> <p>Object serialization is explicit and off by default.</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-15-1><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a><span class=n>data</span> <span class=o>=</span> <span class=n>qt_obj</span><span class=o>.</span><span class=n>to_bytes</span><span class=p>(</span><span class=n>include_objects</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>      <span class=c1># default</span>
</span><span id=__span-15-2><a id=__codelineno-15-2 name=__codelineno-15-2 href=#__codelineno-15-2></a><span class=n>data2</span> <span class=o>=</span> <span class=n>qt_obj</span><span class=o>.</span><span class=n>to_bytes</span><span class=p>(</span><span class=n>include_objects</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>      <span class=c1># opt-in</span>
</span><span id=__span-15-3><a id=__codelineno-15-3 name=__codelineno-15-3 href=#__codelineno-15-3></a>
</span><span id=__span-15-4><a id=__codelineno-15-4 name=__codelineno-15-4 href=#__codelineno-15-4></a><span class=n>qt_obj2</span> <span class=o>=</span> <span class=n>QuadTreeObjects</span><span class=o>.</span><span class=n>from_bytes</span><span class=p>(</span><span class=n>data2</span><span class=p>,</span> <span class=n>allow_objects</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></code></pre></div> <h3 id=safety-notes>Safety notes<a class=headerlink href=#safety-notes title="Permanent link">&para;</a></h3> <ul> <li>Loading objects from bytes uses pickle-like semantics and is unsafe for untrusted data.</li> <li><code>allow_objects</code> defaults to <code>False</code> to prevent accidental unsafe loads.</li> </ul> <h3 id=impact_1>Impact<a class=headerlink href=#impact_1 title="Permanent link">&para;</a></h3> <ul> <li>Remove <code>to_dict()</code></li> <li>Remove <code>dtype=</code> from <code>from_bytes()</code></li> <li>v2 serialization is not backward compatible with v1</li> </ul> <hr> <h1 id=new-features-non-breaking-additions>New Features (Non-breaking additions)<a class=headerlink href=#new-features-non-breaking-additions title="Permanent link">&para;</a></h1> <h2 id=__contains__><code>__contains__</code><a class=headerlink href=#__contains__ title="Permanent link">&para;</a></h2> <div class="language-python highlight"><pre><span></span><code><span id=__span-16-1><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a><span class=k>if</span> <span class=p>(</span><span class=mf>10.0</span><span class=p>,</span> <span class=mf>20.0</span><span class=p>)</span> <span class=ow>in</span> <span class=n>qt</span><span class=p>:</span>
</span><span id=__span-16-2><a id=__codelineno-16-2 name=__codelineno-16-2 href=#__codelineno-16-2></a>    <span class=o>...</span>
</span></code></pre></div> <p>Semantics with duplicates: membership is <code>True</code> if any item exists at that coordinate.</p> <h2 id=iteration>Iteration<a class=headerlink href=#iteration title="Permanent link">&para;</a></h2> <div class="language-python highlight"><pre><span></span><code><span id=__span-17-1><a id=__codelineno-17-1 name=__codelineno-17-1 href=#__codelineno-17-1></a><span class=k>for</span> <span class=n>id_</span><span class=p>,</span> <span class=n>x</span><span class=p>,</span> <span class=n>y</span> <span class=ow>in</span> <span class=n>qt</span><span class=p>:</span>
</span><span id=__span-17-2><a id=__codelineno-17-2 name=__codelineno-17-2 href=#__codelineno-17-2></a>    <span class=o>...</span>
</span><span id=__span-17-3><a id=__codelineno-17-3 name=__codelineno-17-3 href=#__codelineno-17-3></a>
</span><span id=__span-17-4><a id=__codelineno-17-4 name=__codelineno-17-4 href=#__codelineno-17-4></a><span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=n>qt_obj</span><span class=p>:</span>
</span><span id=__span-17-5><a id=__codelineno-17-5 name=__codelineno-17-5 href=#__codelineno-17-5></a>    <span class=o>...</span>
</span></code></pre></div> <h2 id=moving-items-efficient-where-possible>Moving items: efficient where possible<a class=headerlink href=#moving-items-efficient-where-possible title="Permanent link">&para;</a></h2> <h3 id=points>Points<a class=headerlink href=#points title="Permanent link">&para;</a></h3> <ul> <li><code>QuadTreeObjects.update(id_, new_x, new_y)</code> works efficiently (it knows old coords)</li> <li><code>QuadTree.update(...)</code> must include old coords to avoid hidden scans</li> </ul> <div class="language-python highlight"><pre><span></span><code><span id=__span-18-1><a id=__codelineno-18-1 name=__codelineno-18-1 href=#__codelineno-18-1></a><span class=n>qt</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>id_</span><span class=p>,</span> <span class=n>old_x</span><span class=p>,</span> <span class=n>old_y</span><span class=p>,</span> <span class=n>new_x</span><span class=p>,</span> <span class=n>new_y</span><span class=p>)</span>
</span><span id=__span-18-2><a id=__codelineno-18-2 name=__codelineno-18-2 href=#__codelineno-18-2></a><span class=n>qt_obj</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>id_</span><span class=p>,</span> <span class=n>new_x</span><span class=p>,</span> <span class=n>new_y</span><span class=p>)</span>
</span></code></pre></div> <h3 id=rectangles>Rectangles<a class=headerlink href=#rectangles title="Permanent link">&para;</a></h3> <div class="language-python highlight"><pre><span></span><code><span id=__span-19-1><a id=__codelineno-19-1 name=__codelineno-19-1 href=#__codelineno-19-1></a><span class=n>rqt</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>id_</span><span class=p>,</span> <span class=n>old_min_x</span><span class=p>,</span> <span class=n>old_min_y</span><span class=p>,</span> <span class=n>old_max_x</span><span class=p>,</span> <span class=n>old_max_y</span><span class=p>,</span> <span class=n>new_min_x</span><span class=p>,</span> <span class=n>new_min_y</span><span class=p>,</span> <span class=n>new_max_x</span><span class=p>,</span> <span class=n>new_max_y</span><span class=p>)</span>
</span><span id=__span-19-2><a id=__codelineno-19-2 name=__codelineno-19-2 href=#__codelineno-19-2></a><span class=n>rqt_obj</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>id_</span><span class=p>,</span> <span class=n>new_min_x</span><span class=p>,</span> <span class=n>new_min_y</span><span class=p>,</span> <span class=n>new_max_x</span><span class=p>,</span> <span class=n>new_max_y</span><span class=p>)</span>
</span></code></pre></div> <p>This keeps performance promises intact for the non-Objects classes.</p> <h2 id=update_by_object-helper-objects-classes-only><code>update_by_object</code> helper (Objects classes only)<a class=headerlink href=#update_by_object-helper-objects-classes-only title="Permanent link">&para;</a></h2> <p>Objects classes provide a convenience method to update an item by finding it via its associated object (by identity):</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-20-1><a id=__codelineno-20-1 name=__codelineno-20-1 href=#__codelineno-20-1></a><span class=n>qt_obj</span><span class=o>.</span><span class=n>update_by_object</span><span class=p>(</span><span class=n>obj</span><span class=p>,</span> <span class=n>new_x</span><span class=p>,</span> <span class=n>new_y</span><span class=p>)</span>
</span><span id=__span-20-2><a id=__codelineno-20-2 name=__codelineno-20-2 href=#__codelineno-20-2></a><span class=n>rqt_obj</span><span class=o>.</span><span class=n>update_by_object</span><span class=p>(</span><span class=n>obj</span><span class=p>,</span> <span class=n>new_min_x</span><span class=p>,</span> <span class=n>new_min_y</span><span class=p>,</span> <span class=n>new_max_x</span><span class=p>,</span> <span class=n>new_max_y</span><span class=p>)</span>
</span></code></pre></div> <p>If multiple items have the same object, updates the one with the lowest ID.</p> <p>Returns <code>True</code> if the item was found and updated, <code>False</code> otherwise.</p> <hr> <h1 id=migration-guide>Migration Guide<a class=headerlink href=#migration-guide title="Permanent link">&para;</a></h1> <h2 id=step-1-choose-your-class>Step 1: Choose your class<a class=headerlink href=#step-1-choose-your-class title="Permanent link">&para;</a></h2> <table> <thead> <tr> <th>Old usage</th> <th><code>track_objects</code></th> <th>New class</th> </tr> </thead> <tbody> <tr> <td><code>QuadTree</code></td> <td>False</td> <td><code>QuadTree</code></td> </tr> <tr> <td><code>QuadTree</code></td> <td>True</td> <td><code>QuadTreeObjects</code></td> </tr> <tr> <td><code>RectQuadTree</code></td> <td>False</td> <td><code>RectQuadTree</code></td> </tr> <tr> <td><code>RectQuadTree</code></td> <td>True</td> <td><code>RectQuadTreeObjects</code></td> </tr> </tbody> </table> <h2 id=step-2-imports>Step 2: Imports<a class=headerlink href=#step-2-imports title="Permanent link">&para;</a></h2> <div class="language-python highlight"><pre><span></span><code><span id=__span-21-1><a id=__codelineno-21-1 name=__codelineno-21-1 href=#__codelineno-21-1></a><span class=kn>from</span><span class=w> </span><span class=nn>fastquadtree</span><span class=w> </span><span class=kn>import</span> <span class=p>(</span>
</span><span id=__span-21-2><a id=__codelineno-21-2 name=__codelineno-21-2 href=#__codelineno-21-2></a>    <span class=n>QuadTree</span><span class=p>,</span>
</span><span id=__span-21-3><a id=__codelineno-21-3 name=__codelineno-21-3 href=#__codelineno-21-3></a>    <span class=n>QuadTreeObjects</span><span class=p>,</span>
</span><span id=__span-21-4><a id=__codelineno-21-4 name=__codelineno-21-4 href=#__codelineno-21-4></a>    <span class=n>RectQuadTree</span><span class=p>,</span>
</span><span id=__span-21-5><a id=__codelineno-21-5 name=__codelineno-21-5 href=#__codelineno-21-5></a>    <span class=n>RectQuadTreeObjects</span><span class=p>,</span>
</span><span id=__span-21-6><a id=__codelineno-21-6 name=__codelineno-21-6 href=#__codelineno-21-6></a><span class=p>)</span>
</span></code></pre></div> <h2 id=step-3-queries>Step 3: Queries<a class=headerlink href=#step-3-queries title="Permanent link">&para;</a></h2> <table> <thead> <tr> <th>Before</th> <th>After</th> </tr> </thead> <tbody> <tr> <td><code>qt.query(rect, as_items=True)</code></td> <td><code>qt_obj.query(rect)</code></td> </tr> <tr> <td><code>qt.query(rect, as_items=False)</code></td> <td><code>qt.query(rect)</code></td> </tr> </tbody> </table> <h2 id=step-4-numpy-calls>Step 4: NumPy calls<a class=headerlink href=#step-4-numpy-calls title="Permanent link">&para;</a></h2> <table> <thead> <tr> <th>Before</th> <th>After</th> </tr> </thead> <tbody> <tr> <td><code>qt.insert_many(np_array)</code></td> <td><code>qt.insert_many_np(np_array)</code></td> </tr> </tbody> </table> <h2 id=step-5-insert-results>Step 5: Insert results<a class=headerlink href=#step-5-insert-results title="Permanent link">&para;</a></h2> <table> <thead> <tr> <th>Before</th> <th>After</th> </tr> </thead> <tbody> <tr> <td><code>count = qt.insert_many(points)</code></td> <td><code>r = qt.insert_many(points); count = r.count</code></td> </tr> <tr> <td><code>n, start = qt.insert_many(pts, get_start_id=True)</code></td> <td><code>r = qt.insert_many(pts); r.count, r.start_id</code></td> </tr> </tbody> </table> <h2 id=step-6-deletion>Step 6: Deletion<a class=headerlink href=#step-6-deletion title="Permanent link">&para;</a></h2> <table> <thead> <tr> <th>Before</th> <th>After</th> </tr> </thead> <tbody> <tr> <td><code>qt.delete(id_, (x, y))</code></td> <td><code>qt.delete(id_, x, y)</code></td> </tr> <tr> <td><code>qt.delete_by_object(obj)</code></td> <td><code>qt_obj.delete_by_object(obj)</code></td> </tr> </tbody> </table> <h2 id=step-7-updatemove>Step 7: Update/move<a class=headerlink href=#step-7-updatemove title="Permanent link">&para;</a></h2> <ul> <li>If you used object tracking, switch to <code>QuadTreeObjects.update(id_, new_x, new_y)</code></li> <li>If you did not, use <code>QuadTree.update(id_, old_x, old_y, new_x, new_y)</code></li> </ul> <hr> <h1 id=appendix-v20-api-reference-proposed>Appendix: v2.0 API Reference (Proposed)<a class=headerlink href=#appendix-v20-api-reference-proposed title="Permanent link">&para;</a></h1> <h2 id=quadtree-points-no-objects>QuadTree (points, no objects)<a class=headerlink href=#quadtree-points-no-objects title="Permanent link">&para;</a></h2> <div class="language-python highlight"><pre><span></span><code><span id=__span-22-1><a id=__codelineno-22-1 name=__codelineno-22-1 href=#__codelineno-22-1></a><span class=k>class</span><span class=w> </span><span class=nc>QuadTree</span><span class=p>:</span>
</span><span id=__span-22-2><a id=__codelineno-22-2 name=__codelineno-22-2 href=#__codelineno-22-2></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>bounds</span><span class=p>,</span> <span class=n>capacity</span><span class=p>,</span> <span class=n>max_depth</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>dtype</span><span class=o>=</span><span class=s2>&quot;f32&quot;</span><span class=p>):</span> <span class=o>...</span>
</span><span id=__span-22-3><a id=__codelineno-22-3 name=__codelineno-22-3 href=#__codelineno-22-3></a>
</span><span id=__span-22-4><a id=__codelineno-22-4 name=__codelineno-22-4 href=#__codelineno-22-4></a>    <span class=c1># Insertion</span>
</span><span id=__span-22-5><a id=__codelineno-22-5 name=__codelineno-22-5 href=#__codelineno-22-5></a>    <span class=k>def</span><span class=w> </span><span class=nf>insert</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>point</span><span class=p>:</span> <span class=nb>tuple</span><span class=p>[</span><span class=nb>float</span><span class=p>,</span> <span class=nb>float</span><span class=p>],</span> <span class=n>id_</span><span class=p>:</span> <span class=nb>int</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=kc>None</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>int</span><span class=p>:</span> <span class=o>...</span>
</span><span id=__span-22-6><a id=__codelineno-22-6 name=__codelineno-22-6 href=#__codelineno-22-6></a>    <span class=k>def</span><span class=w> </span><span class=nf>insert_many</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>points</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>InsertResult</span><span class=p>:</span> <span class=o>...</span>
</span><span id=__span-22-7><a id=__codelineno-22-7 name=__codelineno-22-7 href=#__codelineno-22-7></a>    <span class=k>def</span><span class=w> </span><span class=nf>insert_many_np</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>points</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>InsertResult</span><span class=p>:</span> <span class=o>...</span>
</span><span id=__span-22-8><a id=__codelineno-22-8 name=__codelineno-22-8 href=#__codelineno-22-8></a>
</span><span id=__span-22-9><a id=__codelineno-22-9 name=__codelineno-22-9 href=#__codelineno-22-9></a>    <span class=c1># Queries</span>
</span><span id=__span-22-10><a id=__codelineno-22-10 name=__codelineno-22-10 href=#__codelineno-22-10></a>    <span class=k>def</span><span class=w> </span><span class=nf>query</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>rect</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>list</span><span class=p>[</span><span class=nb>tuple</span><span class=p>[</span><span class=nb>int</span><span class=p>,</span> <span class=nb>float</span><span class=p>,</span> <span class=nb>float</span><span class=p>]]:</span> <span class=o>...</span>
</span><span id=__span-22-11><a id=__codelineno-22-11 name=__codelineno-22-11 href=#__codelineno-22-11></a>    <span class=k>def</span><span class=w> </span><span class=nf>query_np</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>rect</span><span class=p>):</span> <span class=o>...</span>  <span class=c1># (ids: ndarray[uint64], coords: ndarray[dtype] shape (N,2))</span>
</span><span id=__span-22-12><a id=__codelineno-22-12 name=__codelineno-22-12 href=#__codelineno-22-12></a>    <span class=k>def</span><span class=w> </span><span class=nf>nearest_neighbor</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>point</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>tuple</span><span class=p>[</span><span class=nb>int</span><span class=p>,</span> <span class=nb>float</span><span class=p>,</span> <span class=nb>float</span><span class=p>]</span> <span class=o>|</span> <span class=kc>None</span><span class=p>:</span> <span class=o>...</span>
</span><span id=__span-22-13><a id=__codelineno-22-13 name=__codelineno-22-13 href=#__codelineno-22-13></a>    <span class=k>def</span><span class=w> </span><span class=nf>nearest_neighbor_np</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>point</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>tuple</span><span class=p>[</span><span class=nb>int</span><span class=p>,</span> <span class=s2>&quot;ndarray&quot;</span><span class=p>]</span> <span class=o>|</span> <span class=kc>None</span><span class=p>:</span> <span class=o>...</span>  <span class=c1># (id: uint64, coords: ndarray shape (2,))</span>
</span><span id=__span-22-14><a id=__codelineno-22-14 name=__codelineno-22-14 href=#__codelineno-22-14></a>    <span class=k>def</span><span class=w> </span><span class=nf>nearest_neighbors</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>point</span><span class=p>,</span> <span class=n>k</span><span class=p>:</span> <span class=nb>int</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>list</span><span class=p>[</span><span class=nb>tuple</span><span class=p>[</span><span class=nb>int</span><span class=p>,</span> <span class=nb>float</span><span class=p>,</span> <span class=nb>float</span><span class=p>]]:</span> <span class=o>...</span>
</span><span id=__span-22-15><a id=__codelineno-22-15 name=__codelineno-22-15 href=#__codelineno-22-15></a>    <span class=k>def</span><span class=w> </span><span class=nf>nearest_neighbors_np</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>point</span><span class=p>,</span> <span class=n>k</span><span class=p>:</span> <span class=nb>int</span><span class=p>):</span> <span class=o>...</span>  <span class=c1># (ids: ndarray[uint64], coords: ndarray[dtype] shape (k,2))</span>
</span><span id=__span-22-16><a id=__codelineno-22-16 name=__codelineno-22-16 href=#__codelineno-22-16></a>
</span><span id=__span-22-17><a id=__codelineno-22-17 name=__codelineno-22-17 href=#__codelineno-22-17></a>    <span class=c1># Deletion</span>
</span><span id=__span-22-18><a id=__codelineno-22-18 name=__codelineno-22-18 href=#__codelineno-22-18></a>    <span class=k>def</span><span class=w> </span><span class=nf>delete</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>id_</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span> <span class=n>x</span><span class=p>:</span> <span class=nb>float</span><span class=p>,</span> <span class=n>y</span><span class=p>:</span> <span class=nb>float</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span> <span class=o>...</span>
</span><span id=__span-22-19><a id=__codelineno-22-19 name=__codelineno-22-19 href=#__codelineno-22-19></a>    <span class=k>def</span><span class=w> </span><span class=nf>clear</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span> <span class=o>...</span>
</span><span id=__span-22-20><a id=__codelineno-22-20 name=__codelineno-22-20 href=#__codelineno-22-20></a>
</span><span id=__span-22-21><a id=__codelineno-22-21 name=__codelineno-22-21 href=#__codelineno-22-21></a>    <span class=c1># Mutation</span>
</span><span id=__span-22-22><a id=__codelineno-22-22 name=__codelineno-22-22 href=#__codelineno-22-22></a>    <span class=k>def</span><span class=w> </span><span class=nf>update</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>id_</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span> <span class=n>old_x</span><span class=p>:</span> <span class=nb>float</span><span class=p>,</span> <span class=n>old_y</span><span class=p>:</span> <span class=nb>float</span><span class=p>,</span> <span class=n>new_x</span><span class=p>:</span> <span class=nb>float</span><span class=p>,</span> <span class=n>new_y</span><span class=p>:</span> <span class=nb>float</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span> <span class=o>...</span>
</span><span id=__span-22-23><a id=__codelineno-22-23 name=__codelineno-22-23 href=#__codelineno-22-23></a>
</span><span id=__span-22-24><a id=__codelineno-22-24 name=__codelineno-22-24 href=#__codelineno-22-24></a>    <span class=c1># Utilities</span>
</span><span id=__span-22-25><a id=__codelineno-22-25 name=__codelineno-22-25 href=#__codelineno-22-25></a>    <span class=k>def</span><span class=w> </span><span class=fm>__len__</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>int</span><span class=p>:</span> <span class=o>...</span>
</span><span id=__span-22-26><a id=__codelineno-22-26 name=__codelineno-22-26 href=#__codelineno-22-26></a>    <span class=k>def</span><span class=w> </span><span class=fm>__contains__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>point</span><span class=p>:</span> <span class=nb>tuple</span><span class=p>[</span><span class=nb>float</span><span class=p>,</span> <span class=nb>float</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span> <span class=o>...</span>
</span><span id=__span-22-27><a id=__codelineno-22-27 name=__codelineno-22-27 href=#__codelineno-22-27></a>    <span class=k>def</span><span class=w> </span><span class=fm>__iter__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span> <span class=o>...</span>
</span><span id=__span-22-28><a id=__codelineno-22-28 name=__codelineno-22-28 href=#__codelineno-22-28></a>    <span class=k>def</span><span class=w> </span><span class=nf>get_all_node_boundaries</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>list</span><span class=p>[</span><span class=nb>tuple</span><span class=p>]:</span> <span class=o>...</span>
</span><span id=__span-22-29><a id=__codelineno-22-29 name=__codelineno-22-29 href=#__codelineno-22-29></a>    <span class=k>def</span><span class=w> </span><span class=nf>get_inner_max_depth</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>int</span><span class=p>:</span> <span class=o>...</span>
</span><span id=__span-22-30><a id=__codelineno-22-30 name=__codelineno-22-30 href=#__codelineno-22-30></a>
</span><span id=__span-22-31><a id=__codelineno-22-31 name=__codelineno-22-31 href=#__codelineno-22-31></a>    <span class=c1># Serialization</span>
</span><span id=__span-22-32><a id=__codelineno-22-32 name=__codelineno-22-32 href=#__codelineno-22-32></a>    <span class=k>def</span><span class=w> </span><span class=nf>to_bytes</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bytes</span><span class=p>:</span> <span class=o>...</span>
</span><span id=__span-22-33><a id=__codelineno-22-33 name=__codelineno-22-33 href=#__codelineno-22-33></a>    <span class=nd>@classmethod</span>
</span><span id=__span-22-34><a id=__codelineno-22-34 name=__codelineno-22-34 href=#__codelineno-22-34></a>    <span class=k>def</span><span class=w> </span><span class=nf>from_bytes</span><span class=p>(</span><span class=bp>cls</span><span class=p>,</span> <span class=n>data</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=s2>&quot;QuadTree&quot;</span><span class=p>:</span> <span class=o>...</span>
</span></code></pre></div> <h2 id=quadtreeobjects-points-with-python-objects>QuadTreeObjects (points with Python objects)<a class=headerlink href=#quadtreeobjects-points-with-python-objects title="Permanent link">&para;</a></h2> <div class="language-python highlight"><pre><span></span><code><span id=__span-23-1><a id=__codelineno-23-1 name=__codelineno-23-1 href=#__codelineno-23-1></a><span class=k>class</span><span class=w> </span><span class=nc>QuadTreeObjects</span><span class=p>:</span>
</span><span id=__span-23-2><a id=__codelineno-23-2 name=__codelineno-23-2 href=#__codelineno-23-2></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>bounds</span><span class=p>,</span> <span class=n>capacity</span><span class=p>,</span> <span class=n>max_depth</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>dtype</span><span class=o>=</span><span class=s2>&quot;f32&quot;</span><span class=p>):</span> <span class=o>...</span>
</span><span id=__span-23-3><a id=__codelineno-23-3 name=__codelineno-23-3 href=#__codelineno-23-3></a>
</span><span id=__span-23-4><a id=__codelineno-23-4 name=__codelineno-23-4 href=#__codelineno-23-4></a>    <span class=c1># Insertion (no custom IDs - uses dense allocation)</span>
</span><span id=__span-23-5><a id=__codelineno-23-5 name=__codelineno-23-5 href=#__codelineno-23-5></a>    <span class=k>def</span><span class=w> </span><span class=nf>insert</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>point</span><span class=p>:</span> <span class=nb>tuple</span><span class=p>[</span><span class=nb>float</span><span class=p>,</span> <span class=nb>float</span><span class=p>],</span> <span class=n>obj</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>int</span><span class=p>:</span> <span class=o>...</span>
</span><span id=__span-23-6><a id=__codelineno-23-6 name=__codelineno-23-6 href=#__codelineno-23-6></a>    <span class=k>def</span><span class=w> </span><span class=nf>insert_many</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>points</span><span class=p>,</span> <span class=n>objs</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>InsertResult</span><span class=p>:</span> <span class=o>...</span>
</span><span id=__span-23-7><a id=__codelineno-23-7 name=__codelineno-23-7 href=#__codelineno-23-7></a>    <span class=k>def</span><span class=w> </span><span class=nf>insert_many_np</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>points</span><span class=p>,</span> <span class=n>objs</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>InsertResult</span><span class=p>:</span> <span class=o>...</span>
</span><span id=__span-23-8><a id=__codelineno-23-8 name=__codelineno-23-8 href=#__codelineno-23-8></a>
</span><span id=__span-23-9><a id=__codelineno-23-9 name=__codelineno-23-9 href=#__codelineno-23-9></a>    <span class=c1># Queries</span>
</span><span id=__span-23-10><a id=__codelineno-23-10 name=__codelineno-23-10 href=#__codelineno-23-10></a>    <span class=k>def</span><span class=w> </span><span class=nf>query</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>rect</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>list</span><span class=p>[</span><span class=s2>&quot;PointItem&quot;</span><span class=p>]:</span> <span class=o>...</span>
</span><span id=__span-23-11><a id=__codelineno-23-11 name=__codelineno-23-11 href=#__codelineno-23-11></a>    <span class=k>def</span><span class=w> </span><span class=nf>query_ids</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>rect</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>list</span><span class=p>[</span><span class=nb>int</span><span class=p>]:</span> <span class=o>...</span>
</span><span id=__span-23-12><a id=__codelineno-23-12 name=__codelineno-23-12 href=#__codelineno-23-12></a>    <span class=k>def</span><span class=w> </span><span class=nf>query_np</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>rect</span><span class=p>):</span> <span class=o>...</span>  <span class=c1># ids, coords (coords shape (N,2), dtype matches tree)</span>
</span><span id=__span-23-13><a id=__codelineno-23-13 name=__codelineno-23-13 href=#__codelineno-23-13></a>    <span class=k>def</span><span class=w> </span><span class=nf>nearest_neighbor</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>point</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=s2>&quot;PointItem&quot;</span> <span class=o>|</span> <span class=kc>None</span><span class=p>:</span> <span class=o>...</span>
</span><span id=__span-23-14><a id=__codelineno-23-14 name=__codelineno-23-14 href=#__codelineno-23-14></a>    <span class=k>def</span><span class=w> </span><span class=nf>nearest_neighbors</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>point</span><span class=p>,</span> <span class=n>k</span><span class=p>:</span> <span class=nb>int</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>list</span><span class=p>[</span><span class=s2>&quot;PointItem&quot;</span><span class=p>]:</span> <span class=o>...</span>
</span><span id=__span-23-15><a id=__codelineno-23-15 name=__codelineno-23-15 href=#__codelineno-23-15></a>
</span><span id=__span-23-16><a id=__codelineno-23-16 name=__codelineno-23-16 href=#__codelineno-23-16></a>    <span class=c1># Deletion</span>
</span><span id=__span-23-17><a id=__codelineno-23-17 name=__codelineno-23-17 href=#__codelineno-23-17></a>    <span class=k>def</span><span class=w> </span><span class=nf>delete</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>id_</span><span class=p>:</span> <span class=nb>int</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span> <span class=o>...</span>
</span><span id=__span-23-18><a id=__codelineno-23-18 name=__codelineno-23-18 href=#__codelineno-23-18></a>    <span class=k>def</span><span class=w> </span><span class=nf>delete_at</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>x</span><span class=p>:</span> <span class=nb>float</span><span class=p>,</span> <span class=n>y</span><span class=p>:</span> <span class=nb>float</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span> <span class=o>...</span>  <span class=c1># deletes lowest-id_ match</span>
</span><span id=__span-23-19><a id=__codelineno-23-19 name=__codelineno-23-19 href=#__codelineno-23-19></a>    <span class=k>def</span><span class=w> </span><span class=nf>delete_by_object</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>obj</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>int</span><span class=p>:</span> <span class=o>...</span>            <span class=c1># deletes all, returns count</span>
</span><span id=__span-23-20><a id=__codelineno-23-20 name=__codelineno-23-20 href=#__codelineno-23-20></a>    <span class=k>def</span><span class=w> </span><span class=nf>delete_one_by_object</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>obj</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span> <span class=o>...</span>             <span class=c1># deletes one, lowest id_</span>
</span><span id=__span-23-21><a id=__codelineno-23-21 name=__codelineno-23-21 href=#__codelineno-23-21></a>    <span class=k>def</span><span class=w> </span><span class=nf>clear</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span> <span class=o>...</span>
</span><span id=__span-23-22><a id=__codelineno-23-22 name=__codelineno-23-22 href=#__codelineno-23-22></a>
</span><span id=__span-23-23><a id=__codelineno-23-23 name=__codelineno-23-23 href=#__codelineno-23-23></a>    <span class=c1># Object management</span>
</span><span id=__span-23-24><a id=__codelineno-23-24 name=__codelineno-23-24 href=#__codelineno-23-24></a>    <span class=k>def</span><span class=w> </span><span class=nf>get</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>id_</span><span class=p>:</span> <span class=nb>int</span><span class=p>):</span> <span class=o>...</span>
</span><span id=__span-23-25><a id=__codelineno-23-25 name=__codelineno-23-25 href=#__codelineno-23-25></a>    <span class=k>def</span><span class=w> </span><span class=nf>attach</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>id_</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span> <span class=n>obj</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span> <span class=o>...</span>
</span><span id=__span-23-26><a id=__codelineno-23-26 name=__codelineno-23-26 href=#__codelineno-23-26></a>    <span class=k>def</span><span class=w> </span><span class=nf>get_all_objects</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>list</span><span class=p>:</span> <span class=o>...</span>
</span><span id=__span-23-27><a id=__codelineno-23-27 name=__codelineno-23-27 href=#__codelineno-23-27></a>    <span class=k>def</span><span class=w> </span><span class=nf>get_all_items</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>list</span><span class=p>[</span><span class=s2>&quot;PointItem&quot;</span><span class=p>]:</span> <span class=o>...</span>
</span><span id=__span-23-28><a id=__codelineno-23-28 name=__codelineno-23-28 href=#__codelineno-23-28></a>
</span><span id=__span-23-29><a id=__codelineno-23-29 name=__codelineno-23-29 href=#__codelineno-23-29></a>    <span class=c1># Mutation</span>
</span><span id=__span-23-30><a id=__codelineno-23-30 name=__codelineno-23-30 href=#__codelineno-23-30></a>    <span class=k>def</span><span class=w> </span><span class=nf>update</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>id_</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span> <span class=n>new_x</span><span class=p>:</span> <span class=nb>float</span><span class=p>,</span> <span class=n>new_y</span><span class=p>:</span> <span class=nb>float</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span> <span class=o>...</span>
</span><span id=__span-23-31><a id=__codelineno-23-31 name=__codelineno-23-31 href=#__codelineno-23-31></a>    <span class=k>def</span><span class=w> </span><span class=nf>update_by_object</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>obj</span><span class=p>,</span> <span class=n>new_x</span><span class=p>:</span> <span class=nb>float</span><span class=p>,</span> <span class=n>new_y</span><span class=p>:</span> <span class=nb>float</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span> <span class=o>...</span>
</span><span id=__span-23-32><a id=__codelineno-23-32 name=__codelineno-23-32 href=#__codelineno-23-32></a>
</span><span id=__span-23-33><a id=__codelineno-23-33 name=__codelineno-23-33 href=#__codelineno-23-33></a>    <span class=c1># Utilities</span>
</span><span id=__span-23-34><a id=__codelineno-23-34 name=__codelineno-23-34 href=#__codelineno-23-34></a>    <span class=k>def</span><span class=w> </span><span class=fm>__len__</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>int</span><span class=p>:</span> <span class=o>...</span>
</span><span id=__span-23-35><a id=__codelineno-23-35 name=__codelineno-23-35 href=#__codelineno-23-35></a>    <span class=k>def</span><span class=w> </span><span class=fm>__contains__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>point</span><span class=p>:</span> <span class=nb>tuple</span><span class=p>[</span><span class=nb>float</span><span class=p>,</span> <span class=nb>float</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span> <span class=o>...</span>
</span><span id=__span-23-36><a id=__codelineno-23-36 name=__codelineno-23-36 href=#__codelineno-23-36></a>    <span class=k>def</span><span class=w> </span><span class=fm>__iter__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span> <span class=o>...</span>
</span><span id=__span-23-37><a id=__codelineno-23-37 name=__codelineno-23-37 href=#__codelineno-23-37></a>
</span><span id=__span-23-38><a id=__codelineno-23-38 name=__codelineno-23-38 href=#__codelineno-23-38></a>    <span class=c1># Serialization</span>
</span><span id=__span-23-39><a id=__codelineno-23-39 name=__codelineno-23-39 href=#__codelineno-23-39></a>    <span class=k>def</span><span class=w> </span><span class=nf>to_bytes</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>include_objects</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bytes</span><span class=p>:</span> <span class=o>...</span>
</span><span id=__span-23-40><a id=__codelineno-23-40 name=__codelineno-23-40 href=#__codelineno-23-40></a>    <span class=nd>@classmethod</span>
</span><span id=__span-23-41><a id=__codelineno-23-41 name=__codelineno-23-41 href=#__codelineno-23-41></a>    <span class=k>def</span><span class=w> </span><span class=nf>from_bytes</span><span class=p>(</span><span class=bp>cls</span><span class=p>,</span> <span class=n>data</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>,</span> <span class=n>allow_objects</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=s2>&quot;QuadTreeObjects&quot;</span><span class=p>:</span> <span class=o>...</span>
</span></code></pre></div> <h2 id=rectquadtree-rectangles-no-objects>RectQuadTree (rectangles, no objects)<a class=headerlink href=#rectquadtree-rectangles-no-objects title="Permanent link">&para;</a></h2> <div class="language-python highlight"><pre><span></span><code><span id=__span-24-1><a id=__codelineno-24-1 name=__codelineno-24-1 href=#__codelineno-24-1></a><span class=k>class</span><span class=w> </span><span class=nc>RectQuadTree</span><span class=p>:</span>
</span><span id=__span-24-2><a id=__codelineno-24-2 name=__codelineno-24-2 href=#__codelineno-24-2></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>bounds</span><span class=p>,</span> <span class=n>capacity</span><span class=p>,</span> <span class=n>max_depth</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>dtype</span><span class=o>=</span><span class=s2>&quot;f32&quot;</span><span class=p>):</span> <span class=o>...</span>
</span><span id=__span-24-3><a id=__codelineno-24-3 name=__codelineno-24-3 href=#__codelineno-24-3></a>
</span><span id=__span-24-4><a id=__codelineno-24-4 name=__codelineno-24-4 href=#__codelineno-24-4></a>    <span class=c1># Insertion</span>
</span><span id=__span-24-5><a id=__codelineno-24-5 name=__codelineno-24-5 href=#__codelineno-24-5></a>    <span class=k>def</span><span class=w> </span><span class=nf>insert</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>rect</span><span class=p>:</span> <span class=nb>tuple</span><span class=p>[</span><span class=nb>float</span><span class=p>,</span> <span class=nb>float</span><span class=p>,</span> <span class=nb>float</span><span class=p>,</span> <span class=nb>float</span><span class=p>],</span> <span class=n>id_</span><span class=p>:</span> <span class=nb>int</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=kc>None</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>int</span><span class=p>:</span> <span class=o>...</span>
</span><span id=__span-24-6><a id=__codelineno-24-6 name=__codelineno-24-6 href=#__codelineno-24-6></a>    <span class=k>def</span><span class=w> </span><span class=nf>insert_many</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>rects</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>InsertResult</span><span class=p>:</span> <span class=o>...</span>
</span><span id=__span-24-7><a id=__codelineno-24-7 name=__codelineno-24-7 href=#__codelineno-24-7></a>    <span class=k>def</span><span class=w> </span><span class=nf>insert_many_np</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>rects</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>InsertResult</span><span class=p>:</span> <span class=o>...</span>
</span><span id=__span-24-8><a id=__codelineno-24-8 name=__codelineno-24-8 href=#__codelineno-24-8></a>
</span><span id=__span-24-9><a id=__codelineno-24-9 name=__codelineno-24-9 href=#__codelineno-24-9></a>    <span class=c1># Queries</span>
</span><span id=__span-24-10><a id=__codelineno-24-10 name=__codelineno-24-10 href=#__codelineno-24-10></a>    <span class=k>def</span><span class=w> </span><span class=nf>query</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>rect</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>list</span><span class=p>[</span><span class=nb>tuple</span><span class=p>[</span><span class=nb>int</span><span class=p>,</span> <span class=nb>float</span><span class=p>,</span> <span class=nb>float</span><span class=p>,</span> <span class=nb>float</span><span class=p>,</span> <span class=nb>float</span><span class=p>]]:</span> <span class=o>...</span>
</span><span id=__span-24-11><a id=__codelineno-24-11 name=__codelineno-24-11 href=#__codelineno-24-11></a>    <span class=k>def</span><span class=w> </span><span class=nf>query_np</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>rect</span><span class=p>):</span> <span class=o>...</span>  <span class=c1># (ids: ndarray[uint64], coords: ndarray[dtype] shape (N,4))</span>
</span><span id=__span-24-12><a id=__codelineno-24-12 name=__codelineno-24-12 href=#__codelineno-24-12></a>    <span class=k>def</span><span class=w> </span><span class=nf>nearest_neighbor</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>point</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>tuple</span><span class=p>[</span><span class=nb>int</span><span class=p>,</span> <span class=nb>float</span><span class=p>,</span> <span class=nb>float</span><span class=p>,</span> <span class=nb>float</span><span class=p>,</span> <span class=nb>float</span><span class=p>]</span> <span class=o>|</span> <span class=kc>None</span><span class=p>:</span> <span class=o>...</span>
</span><span id=__span-24-13><a id=__codelineno-24-13 name=__codelineno-24-13 href=#__codelineno-24-13></a>    <span class=k>def</span><span class=w> </span><span class=nf>nearest_neighbor_np</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>point</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>tuple</span><span class=p>[</span><span class=nb>int</span><span class=p>,</span> <span class=s2>&quot;ndarray&quot;</span><span class=p>]</span> <span class=o>|</span> <span class=kc>None</span><span class=p>:</span> <span class=o>...</span>  <span class=c1># (id: uint64, coords: ndarray shape (4,))</span>
</span><span id=__span-24-14><a id=__codelineno-24-14 name=__codelineno-24-14 href=#__codelineno-24-14></a>    <span class=k>def</span><span class=w> </span><span class=nf>nearest_neighbors</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>point</span><span class=p>,</span> <span class=n>k</span><span class=p>:</span> <span class=nb>int</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>list</span><span class=p>[</span><span class=nb>tuple</span><span class=p>[</span><span class=nb>int</span><span class=p>,</span> <span class=nb>float</span><span class=p>,</span> <span class=nb>float</span><span class=p>,</span> <span class=nb>float</span><span class=p>,</span> <span class=nb>float</span><span class=p>]]:</span> <span class=o>...</span>
</span><span id=__span-24-15><a id=__codelineno-24-15 name=__codelineno-24-15 href=#__codelineno-24-15></a>    <span class=k>def</span><span class=w> </span><span class=nf>nearest_neighbors_np</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>point</span><span class=p>,</span> <span class=n>k</span><span class=p>:</span> <span class=nb>int</span><span class=p>):</span> <span class=o>...</span>  <span class=c1># (ids: ndarray[uint64], coords: ndarray[dtype] shape (k,4))</span>
</span><span id=__span-24-16><a id=__codelineno-24-16 name=__codelineno-24-16 href=#__codelineno-24-16></a>
</span><span id=__span-24-17><a id=__codelineno-24-17 name=__codelineno-24-17 href=#__codelineno-24-17></a>    <span class=c1># Deletion</span>
</span><span id=__span-24-18><a id=__codelineno-24-18 name=__codelineno-24-18 href=#__codelineno-24-18></a>    <span class=k>def</span><span class=w> </span><span class=nf>delete</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>id_</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span> <span class=n>min_x</span><span class=p>:</span> <span class=nb>float</span><span class=p>,</span> <span class=n>min_y</span><span class=p>:</span> <span class=nb>float</span><span class=p>,</span> <span class=n>max_x</span><span class=p>:</span> <span class=nb>float</span><span class=p>,</span> <span class=n>max_y</span><span class=p>:</span> <span class=nb>float</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span> <span class=o>...</span>
</span><span id=__span-24-19><a id=__codelineno-24-19 name=__codelineno-24-19 href=#__codelineno-24-19></a>    <span class=k>def</span><span class=w> </span><span class=nf>clear</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span> <span class=o>...</span>
</span><span id=__span-24-20><a id=__codelineno-24-20 name=__codelineno-24-20 href=#__codelineno-24-20></a>
</span><span id=__span-24-21><a id=__codelineno-24-21 name=__codelineno-24-21 href=#__codelineno-24-21></a>    <span class=c1># Mutation</span>
</span><span id=__span-24-22><a id=__codelineno-24-22 name=__codelineno-24-22 href=#__codelineno-24-22></a>    <span class=k>def</span><span class=w> </span><span class=nf>update</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>id_</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span> <span class=n>old_min_x</span><span class=p>:</span> <span class=nb>float</span><span class=p>,</span> <span class=n>old_min_y</span><span class=p>:</span> <span class=nb>float</span><span class=p>,</span> <span class=n>old_max_x</span><span class=p>:</span> <span class=nb>float</span><span class=p>,</span> <span class=n>old_max_y</span><span class=p>:</span> <span class=nb>float</span><span class=p>,</span>
</span><span id=__span-24-23><a id=__codelineno-24-23 name=__codelineno-24-23 href=#__codelineno-24-23></a>               <span class=n>new_min_x</span><span class=p>:</span> <span class=nb>float</span><span class=p>,</span> <span class=n>new_min_y</span><span class=p>:</span> <span class=nb>float</span><span class=p>,</span> <span class=n>new_max_x</span><span class=p>:</span> <span class=nb>float</span><span class=p>,</span> <span class=n>new_max_y</span><span class=p>:</span> <span class=nb>float</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span> <span class=o>...</span>
</span><span id=__span-24-24><a id=__codelineno-24-24 name=__codelineno-24-24 href=#__codelineno-24-24></a>
</span><span id=__span-24-25><a id=__codelineno-24-25 name=__codelineno-24-25 href=#__codelineno-24-25></a>    <span class=c1># Utilities</span>
</span><span id=__span-24-26><a id=__codelineno-24-26 name=__codelineno-24-26 href=#__codelineno-24-26></a>    <span class=k>def</span><span class=w> </span><span class=fm>__len__</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>int</span><span class=p>:</span> <span class=o>...</span>
</span><span id=__span-24-27><a id=__codelineno-24-27 name=__codelineno-24-27 href=#__codelineno-24-27></a>    <span class=k>def</span><span class=w> </span><span class=fm>__contains__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>rect</span><span class=p>:</span> <span class=nb>tuple</span><span class=p>[</span><span class=nb>float</span><span class=p>,</span> <span class=nb>float</span><span class=p>,</span> <span class=nb>float</span><span class=p>,</span> <span class=nb>float</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span> <span class=o>...</span>
</span><span id=__span-24-28><a id=__codelineno-24-28 name=__codelineno-24-28 href=#__codelineno-24-28></a>    <span class=k>def</span><span class=w> </span><span class=fm>__iter__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span> <span class=o>...</span>
</span><span id=__span-24-29><a id=__codelineno-24-29 name=__codelineno-24-29 href=#__codelineno-24-29></a>    <span class=k>def</span><span class=w> </span><span class=nf>get_all_node_boundaries</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>list</span><span class=p>[</span><span class=nb>tuple</span><span class=p>]:</span> <span class=o>...</span>
</span><span id=__span-24-30><a id=__codelineno-24-30 name=__codelineno-24-30 href=#__codelineno-24-30></a>    <span class=k>def</span><span class=w> </span><span class=nf>get_inner_max_depth</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>int</span><span class=p>:</span> <span class=o>...</span>
</span><span id=__span-24-31><a id=__codelineno-24-31 name=__codelineno-24-31 href=#__codelineno-24-31></a>
</span><span id=__span-24-32><a id=__codelineno-24-32 name=__codelineno-24-32 href=#__codelineno-24-32></a>    <span class=c1># Serialization</span>
</span><span id=__span-24-33><a id=__codelineno-24-33 name=__codelineno-24-33 href=#__codelineno-24-33></a>    <span class=k>def</span><span class=w> </span><span class=nf>to_bytes</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bytes</span><span class=p>:</span> <span class=o>...</span>
</span><span id=__span-24-34><a id=__codelineno-24-34 name=__codelineno-24-34 href=#__codelineno-24-34></a>    <span class=nd>@classmethod</span>
</span><span id=__span-24-35><a id=__codelineno-24-35 name=__codelineno-24-35 href=#__codelineno-24-35></a>    <span class=k>def</span><span class=w> </span><span class=nf>from_bytes</span><span class=p>(</span><span class=bp>cls</span><span class=p>,</span> <span class=n>data</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=s2>&quot;RectQuadTree&quot;</span><span class=p>:</span> <span class=o>...</span>
</span></code></pre></div> <h2 id=rectquadtreeobjects-rectangles-with-python-objects>RectQuadTreeObjects (rectangles with Python objects)<a class=headerlink href=#rectquadtreeobjects-rectangles-with-python-objects title="Permanent link">&para;</a></h2> <div class="language-python highlight"><pre><span></span><code><span id=__span-25-1><a id=__codelineno-25-1 name=__codelineno-25-1 href=#__codelineno-25-1></a><span class=k>class</span><span class=w> </span><span class=nc>RectQuadTreeObjects</span><span class=p>:</span>
</span><span id=__span-25-2><a id=__codelineno-25-2 name=__codelineno-25-2 href=#__codelineno-25-2></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>bounds</span><span class=p>,</span> <span class=n>capacity</span><span class=p>,</span> <span class=n>max_depth</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>dtype</span><span class=o>=</span><span class=s2>&quot;f32&quot;</span><span class=p>):</span> <span class=o>...</span>
</span><span id=__span-25-3><a id=__codelineno-25-3 name=__codelineno-25-3 href=#__codelineno-25-3></a>
</span><span id=__span-25-4><a id=__codelineno-25-4 name=__codelineno-25-4 href=#__codelineno-25-4></a>    <span class=c1># Insertion (no custom IDs - uses dense allocation)</span>
</span><span id=__span-25-5><a id=__codelineno-25-5 name=__codelineno-25-5 href=#__codelineno-25-5></a>    <span class=k>def</span><span class=w> </span><span class=nf>insert</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>rect</span><span class=p>:</span> <span class=nb>tuple</span><span class=p>[</span><span class=nb>float</span><span class=p>,</span> <span class=nb>float</span><span class=p>,</span> <span class=nb>float</span><span class=p>,</span> <span class=nb>float</span><span class=p>],</span> <span class=n>obj</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>int</span><span class=p>:</span> <span class=o>...</span>
</span><span id=__span-25-6><a id=__codelineno-25-6 name=__codelineno-25-6 href=#__codelineno-25-6></a>    <span class=k>def</span><span class=w> </span><span class=nf>insert_many</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>rects</span><span class=p>,</span> <span class=n>objs</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>InsertResult</span><span class=p>:</span> <span class=o>...</span>
</span><span id=__span-25-7><a id=__codelineno-25-7 name=__codelineno-25-7 href=#__codelineno-25-7></a>    <span class=k>def</span><span class=w> </span><span class=nf>insert_many_np</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>rects</span><span class=p>,</span> <span class=n>objs</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>InsertResult</span><span class=p>:</span> <span class=o>...</span>
</span><span id=__span-25-8><a id=__codelineno-25-8 name=__codelineno-25-8 href=#__codelineno-25-8></a>
</span><span id=__span-25-9><a id=__codelineno-25-9 name=__codelineno-25-9 href=#__codelineno-25-9></a>    <span class=c1># Queries</span>
</span><span id=__span-25-10><a id=__codelineno-25-10 name=__codelineno-25-10 href=#__codelineno-25-10></a>    <span class=k>def</span><span class=w> </span><span class=nf>query</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>rect</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>list</span><span class=p>[</span><span class=s2>&quot;RectItem&quot;</span><span class=p>]:</span> <span class=o>...</span>
</span><span id=__span-25-11><a id=__codelineno-25-11 name=__codelineno-25-11 href=#__codelineno-25-11></a>    <span class=k>def</span><span class=w> </span><span class=nf>query_ids</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>rect</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>list</span><span class=p>[</span><span class=nb>int</span><span class=p>]:</span> <span class=o>...</span>
</span><span id=__span-25-12><a id=__codelineno-25-12 name=__codelineno-25-12 href=#__codelineno-25-12></a>    <span class=k>def</span><span class=w> </span><span class=nf>query_np</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>rect</span><span class=p>):</span> <span class=o>...</span>  <span class=c1># ids, coords (coords shape (N,4), dtype matches tree)</span>
</span><span id=__span-25-13><a id=__codelineno-25-13 name=__codelineno-25-13 href=#__codelineno-25-13></a>    <span class=k>def</span><span class=w> </span><span class=nf>nearest_neighbor</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>point</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=s2>&quot;RectItem&quot;</span> <span class=o>|</span> <span class=kc>None</span><span class=p>:</span> <span class=o>...</span>
</span><span id=__span-25-14><a id=__codelineno-25-14 name=__codelineno-25-14 href=#__codelineno-25-14></a>    <span class=k>def</span><span class=w> </span><span class=nf>nearest_neighbors</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>point</span><span class=p>,</span> <span class=n>k</span><span class=p>:</span> <span class=nb>int</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>list</span><span class=p>[</span><span class=s2>&quot;RectItem&quot;</span><span class=p>]:</span> <span class=o>...</span>
</span><span id=__span-25-15><a id=__codelineno-25-15 name=__codelineno-25-15 href=#__codelineno-25-15></a>
</span><span id=__span-25-16><a id=__codelineno-25-16 name=__codelineno-25-16 href=#__codelineno-25-16></a>    <span class=c1># Deletion</span>
</span><span id=__span-25-17><a id=__codelineno-25-17 name=__codelineno-25-17 href=#__codelineno-25-17></a>    <span class=k>def</span><span class=w> </span><span class=nf>delete</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>id_</span><span class=p>:</span> <span class=nb>int</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span> <span class=o>...</span>
</span><span id=__span-25-18><a id=__codelineno-25-18 name=__codelineno-25-18 href=#__codelineno-25-18></a>    <span class=k>def</span><span class=w> </span><span class=nf>delete_at</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>min_x</span><span class=p>:</span> <span class=nb>float</span><span class=p>,</span> <span class=n>min_y</span><span class=p>:</span> <span class=nb>float</span><span class=p>,</span> <span class=n>max_x</span><span class=p>:</span> <span class=nb>float</span><span class=p>,</span> <span class=n>max_y</span><span class=p>:</span> <span class=nb>float</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span> <span class=o>...</span>
</span><span id=__span-25-19><a id=__codelineno-25-19 name=__codelineno-25-19 href=#__codelineno-25-19></a>    <span class=k>def</span><span class=w> </span><span class=nf>delete_by_object</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>obj</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>int</span><span class=p>:</span> <span class=o>...</span>
</span><span id=__span-25-20><a id=__codelineno-25-20 name=__codelineno-25-20 href=#__codelineno-25-20></a>    <span class=k>def</span><span class=w> </span><span class=nf>delete_one_by_object</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>obj</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span> <span class=o>...</span>
</span><span id=__span-25-21><a id=__codelineno-25-21 name=__codelineno-25-21 href=#__codelineno-25-21></a>    <span class=k>def</span><span class=w> </span><span class=nf>clear</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span> <span class=o>...</span>
</span><span id=__span-25-22><a id=__codelineno-25-22 name=__codelineno-25-22 href=#__codelineno-25-22></a>
</span><span id=__span-25-23><a id=__codelineno-25-23 name=__codelineno-25-23 href=#__codelineno-25-23></a>    <span class=c1># Object management</span>
</span><span id=__span-25-24><a id=__codelineno-25-24 name=__codelineno-25-24 href=#__codelineno-25-24></a>    <span class=k>def</span><span class=w> </span><span class=nf>get</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>id_</span><span class=p>:</span> <span class=nb>int</span><span class=p>):</span> <span class=o>...</span>
</span><span id=__span-25-25><a id=__codelineno-25-25 name=__codelineno-25-25 href=#__codelineno-25-25></a>    <span class=k>def</span><span class=w> </span><span class=nf>attach</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>id_</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span> <span class=n>obj</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span> <span class=o>...</span>
</span><span id=__span-25-26><a id=__codelineno-25-26 name=__codelineno-25-26 href=#__codelineno-25-26></a>    <span class=k>def</span><span class=w> </span><span class=nf>get_all_objects</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>list</span><span class=p>:</span> <span class=o>...</span>
</span><span id=__span-25-27><a id=__codelineno-25-27 name=__codelineno-25-27 href=#__codelineno-25-27></a>    <span class=k>def</span><span class=w> </span><span class=nf>get_all_items</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>list</span><span class=p>[</span><span class=s2>&quot;RectItem&quot;</span><span class=p>]:</span> <span class=o>...</span>
</span><span id=__span-25-28><a id=__codelineno-25-28 name=__codelineno-25-28 href=#__codelineno-25-28></a>
</span><span id=__span-25-29><a id=__codelineno-25-29 name=__codelineno-25-29 href=#__codelineno-25-29></a>    <span class=c1># Mutation</span>
</span><span id=__span-25-30><a id=__codelineno-25-30 name=__codelineno-25-30 href=#__codelineno-25-30></a>    <span class=k>def</span><span class=w> </span><span class=nf>update</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>id_</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span> <span class=n>new_min_x</span><span class=p>:</span> <span class=nb>float</span><span class=p>,</span> <span class=n>new_min_y</span><span class=p>:</span> <span class=nb>float</span><span class=p>,</span> <span class=n>new_max_x</span><span class=p>:</span> <span class=nb>float</span><span class=p>,</span> <span class=n>new_max_y</span><span class=p>:</span> <span class=nb>float</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span> <span class=o>...</span>
</span><span id=__span-25-31><a id=__codelineno-25-31 name=__codelineno-25-31 href=#__codelineno-25-31></a>    <span class=k>def</span><span class=w> </span><span class=nf>update_by_object</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>obj</span><span class=p>,</span> <span class=n>new_min_x</span><span class=p>:</span> <span class=nb>float</span><span class=p>,</span> <span class=n>new_min_y</span><span class=p>:</span> <span class=nb>float</span><span class=p>,</span> <span class=n>new_max_x</span><span class=p>:</span> <span class=nb>float</span><span class=p>,</span> <span class=n>new_max_y</span><span class=p>:</span> <span class=nb>float</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span> <span class=o>...</span>
</span><span id=__span-25-32><a id=__codelineno-25-32 name=__codelineno-25-32 href=#__codelineno-25-32></a>
</span><span id=__span-25-33><a id=__codelineno-25-33 name=__codelineno-25-33 href=#__codelineno-25-33></a>    <span class=c1># Utilities</span>
</span><span id=__span-25-34><a id=__codelineno-25-34 name=__codelineno-25-34 href=#__codelineno-25-34></a>    <span class=k>def</span><span class=w> </span><span class=fm>__len__</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>int</span><span class=p>:</span> <span class=o>...</span>
</span><span id=__span-25-35><a id=__codelineno-25-35 name=__codelineno-25-35 href=#__codelineno-25-35></a>    <span class=k>def</span><span class=w> </span><span class=fm>__contains__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>rect</span><span class=p>:</span> <span class=nb>tuple</span><span class=p>[</span><span class=nb>float</span><span class=p>,</span> <span class=nb>float</span><span class=p>,</span> <span class=nb>float</span><span class=p>,</span> <span class=nb>float</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span> <span class=o>...</span>
</span><span id=__span-25-36><a id=__codelineno-25-36 name=__codelineno-25-36 href=#__codelineno-25-36></a>    <span class=k>def</span><span class=w> </span><span class=fm>__iter__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span> <span class=o>...</span>
</span><span id=__span-25-37><a id=__codelineno-25-37 name=__codelineno-25-37 href=#__codelineno-25-37></a>
</span><span id=__span-25-38><a id=__codelineno-25-38 name=__codelineno-25-38 href=#__codelineno-25-38></a>    <span class=c1># Serialization</span>
</span><span id=__span-25-39><a id=__codelineno-25-39 name=__codelineno-25-39 href=#__codelineno-25-39></a>    <span class=k>def</span><span class=w> </span><span class=nf>to_bytes</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>include_objects</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bytes</span><span class=p>:</span> <span class=o>...</span>
</span><span id=__span-25-40><a id=__codelineno-25-40 name=__codelineno-25-40 href=#__codelineno-25-40></a>    <span class=nd>@classmethod</span>
</span><span id=__span-25-41><a id=__codelineno-25-41 name=__codelineno-25-41 href=#__codelineno-25-41></a>    <span class=k>def</span><span class=w> </span><span class=nf>from_bytes</span><span class=p>(</span><span class=bp>cls</span><span class=p>,</span> <span class=n>data</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>,</span> <span class=n>allow_objects</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=s2>&quot;RectQuadTreeObjects&quot;</span><span class=p>:</span> <span class=o>...</span>
</span></code></pre></div> <h2 id=data-classes>Data Classes<a class=headerlink href=#data-classes title="Permanent link">&para;</a></h2> <div class="language-python highlight"><pre><span></span><code><span id=__span-26-1><a id=__codelineno-26-1 name=__codelineno-26-1 href=#__codelineno-26-1></a><span class=nd>@dataclass</span>
</span><span id=__span-26-2><a id=__codelineno-26-2 name=__codelineno-26-2 href=#__codelineno-26-2></a><span class=k>class</span><span class=w> </span><span class=nc>InsertResult</span><span class=p>:</span>
</span><span id=__span-26-3><a id=__codelineno-26-3 name=__codelineno-26-3 href=#__codelineno-26-3></a>    <span class=n>count</span><span class=p>:</span> <span class=nb>int</span>
</span><span id=__span-26-4><a id=__codelineno-26-4 name=__codelineno-26-4 href=#__codelineno-26-4></a>    <span class=n>start_id</span><span class=p>:</span> <span class=nb>int</span>
</span><span id=__span-26-5><a id=__codelineno-26-5 name=__codelineno-26-5 href=#__codelineno-26-5></a>    <span class=n>end_id</span><span class=p>:</span> <span class=nb>int</span>
</span><span id=__span-26-6><a id=__codelineno-26-6 name=__codelineno-26-6 href=#__codelineno-26-6></a>
</span><span id=__span-26-7><a id=__codelineno-26-7 name=__codelineno-26-7 href=#__codelineno-26-7></a>    <span class=nd>@property</span>
</span><span id=__span-26-8><a id=__codelineno-26-8 name=__codelineno-26-8 href=#__codelineno-26-8></a>    <span class=k>def</span><span class=w> </span><span class=nf>ids</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>range</span><span class=p>:</span>
</span><span id=__span-26-9><a id=__codelineno-26-9 name=__codelineno-26-9 href=#__codelineno-26-9></a>        <span class=k>return</span> <span class=nb>range</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>start_id</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>end_id</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span>
</span></code></pre></div> <hr> <h1 id=implementation-details>Implementation Details<a class=headerlink href=#implementation-details title="Permanent link">&para;</a></h1> <h2 id=objstore-efficient-object-tracking>ObjStore: Efficient Object Tracking<a class=headerlink href=#objstore-efficient-object-tracking title="Permanent link">&para;</a></h2> <p>The <code>ObjStore</code> class (used internally by <code>QuadTreeObjects</code> and <code>RectQuadTreeObjects</code>) maintains a bidirectional mapping between IDs and Python objects:</p> <p><strong>Storage:</strong> - <code>_arr[id]</code>  Item or None (dense array) - <code>_objs[id]</code>  Python object or None (parallel array) - <code>_obj_to_ids</code>  <code>dict[int, set[int]]</code> reverse map from <code>id(obj)</code> to all associated IDs - <code>_free</code>  LIFO free-list of reusable IDs</p> <p><strong>Key behaviors:</strong> 1. <strong>Multiple insertions of the same object are tracked</strong>: When the same Python object is inserted multiple times at different locations, all IDs are stored in a set 2. <strong>Deterministic lookup</strong>: <code>by_obj(obj)</code> returns the item with the lowest ID (using <code>min(ids)</code>) 3. <strong>Efficient deletion</strong>: <code>delete_by_object()</code> retrieves all IDs via <code>by_obj_all()</code> and deletes each one 4. <strong>Safe object replacement</strong>: <code>attach(id, new_obj)</code> correctly removes the old object's ID from the reverse map, preventing corruption</p> <p><strong>Performance characteristics:</strong> - <code>add()</code>: O(1) average (set insertion) - <code>by_obj()</code>: O(k) where k = number of duplicates (typically small; <code>min()</code> on small sets is fast) - <code>by_obj_all()</code>: O(k log k) for sorting - <code>pop_id()</code>: O(1) average (set removal) - Memory overhead: ~8 bytes per duplicate object insertion (set entry)</p> <p>This design ensures correct semantics for duplicate objects while maintaining excellent performance for the common case (no duplicates).</p> <aside class=md-source-file> <span class=md-source-file__fact> <span class=md-icon title="Last update"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="December 21, 2025 06:25:58 UTC">December 21, 2025</span> </span> </aside> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> MIT </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/Elan456/fastquadtree target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </a> <a href=https://pypi.org/project/fastquadtree/ target=_blank rel=noopener title=pypi.org class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.8 200.5c-7.7-30.9-22.3-54.2-53.4-54.2h-40.1v47.4c0 36.8-31.2 67.8-66.8 67.8H172.7c-29.2 0-53.4 25-53.4 54.3v101.8c0 29 25.2 46 53.4 54.3 33.8 9.9 66.3 11.7 106.8 0 26.9-7.8 53.4-23.5 53.4-54.3v-40.7H226.2v-13.6h160.2c31.1 0 42.6-21.7 53.4-54.2 11.2-33.5 10.7-65.7 0-108.6M286.2 444.7a20.4 20.4 0 1 1 0-40.7 20.4 20.4 0 1 1 0 40.7M167.8 248.1h106.8c29.7 0 53.4-24.5 53.4-54.3V91.9c0-29-24.4-50.7-53.4-55.6-35.8-5.9-74.7-5.6-106.8.1-45.2 8-53.4 24.7-53.4 55.6v40.7h106.9v13.6h-147c-31.1 0-58.3 18.7-66.8 54.2-9.8 40.7-10.2 66.1 0 108.6 7.6 31.6 25.7 54.2 56.8 54.2H101v-48.8c0-35.3 30.5-66.4 66.8-66.4m-6.6-183.4a20.4 20.4 0 1 1 0 40.8 20.4 20.4 0 1 1 0-40.8"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"annotate": null, "base": "..", "features": ["navigation.sections", "navigation.tracking", "navigation.indexes", "content.code.copy", "toc.follow", "search.suggest", "search.highlight", "content.tooltips", "navigation.footer", "navigation.top"], "search": "../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script> <script src=../assets/javascripts/bundle.79ae519e.min.js></script> </body> </html>